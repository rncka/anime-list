<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ì• ë‹ˆë¦¬ìŠ¤íŠ¸</title>
    <link rel="apple-touch-icon" href="https://via.placeholder.com/192.png?text=Anime"> <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <style>
        :root {
            --bg-color: #000000;
            --card-bg: #1C1C1E;
            --text-primary: #FFFFFF;
            --text-secondary: #8E8E93;
            --accent-pink: #FF6482; /* ìŠ¤í¬ë¦°ìƒ·ì˜ í•‘í¬ìƒ‰ */
            --search-bg: #2C2C2E;
            --separator: #38383A;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Apple SD Gothic Neo", "Malgun Gothic", sans-serif;
            background-color: var(--bg-color);
            color: var(--text-primary);
            margin: 0;
            padding: 20px;
            padding-bottom: 100px;
            -webkit-font-smoothing: antialiased;
        }

        /* í—¤ë” ì˜ì—­ */
        header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
            padding-top: 20px; /* ìƒíƒœë°” ì—¬ë°± */
        }

        h1 {
            font-size: 28px;
            font-weight: 800;
            margin: 0;
        }

        .header-controls {
            display: flex;
            gap: 15px;
        }

        /* ê²€ìƒ‰ì°½ & ë°±ì—… ë²„íŠ¼ */
        .search-bar {
            background-color: var(--search-bg);
            border-radius: 10px;
            padding: 8px 12px;
            display: flex;
            align-items: center;
            flex-grow: 1;
            margin-left: 15px;
        }

        .search-bar input {
            background: transparent;
            border: none;
            color: white;
            font-size: 16px;
            width: 100%;
            outline: none;
        }

        .icon-btn {
            background: none;
            border: none;
            color: var(--accent-pink);
            font-size: 20px;
            cursor: pointer;
        }

        /* ë¦¬ìŠ¤íŠ¸ ë ˆì´ì•„ì›ƒ */
        #anime-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        /* ì¹´ë“œ ë””ìì¸ (ìŠ¤í¬ë¦°ìƒ· ì°¸ê³ ) */
        .card {
            background-color: var(--card-bg);
            border-radius: 14px;
            padding: 12px;
            display: flex;
            align-items: center; /* ì„¸ë¡œ ì¤‘ì•™ ì •ë ¬ */
            position: relative;
        }

        .poster {
            width: 70px;
            height: 100px;
            border-radius: 8px;
            object-fit: cover;
            background-color: #333;
            margin-right: 14px;
            flex-shrink: 0;
        }

        .info {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            height: 90px;
        }

        .header-row {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .title {
            font-size: 17px;
            font-weight: 700;
            line-height: 1.3;
            margin-bottom: 4px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            color: var(--text-primary);
        }

        .status-select {
            background-color: #333;
            color: #ddd;
            border: none;
            border-radius: 6px;
            padding: 4px 8px;
            font-size: 12px;
            font-weight: 600;
            outline: none;
            -webkit-appearance: none; /* í™”ì‚´í‘œ ìˆ¨ê¹€ (ì»¤ìŠ¤í…€ ë””ìì¸ ìœ„í•´) */
            text-align: center;
        }

        .meta {
            font-size: 14px;
            color: var(--text-secondary);
            font-weight: 500;
        }

        /* í•‘í¬ìƒ‰ ë‹¤ìŒí™” ë²„íŠ¼ */
        .next-btn {
            background-color: var(--accent-pink);
            color: white;
            border: none;
            border-radius: 20px; /* ë‘¥ê·¼ ì•Œì•½ ëª¨ì–‘ */
            padding: 6px 14px;
            font-size: 13px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 4px;
            width: fit-content;
            cursor: pointer;
            margin-top: auto; /* ì•„ë˜ë¡œ ë°€ê¸° */
            box-shadow: 0 2px 8px rgba(255, 100, 130, 0.3);
            transition: transform 0.1s;
        }

        .next-btn:active { transform: scale(0.95); }

        /* ì‚­ì œ ë²„íŠ¼ (ì˜¤ë¥¸ìª½ ìœ„ ìˆ¨ê¹€) */
        .delete-btn {
            position: absolute;
            bottom: 12px;
            right: 12px;
            background: none;
            border: none;
            color: #555;
            font-size: 18px;
            cursor: pointer;
        }

        /* ì¶”ê°€ ë²„íŠ¼ (í”Œë¡œíŒ…) */
        .fab {
            position: fixed;
            bottom: 30px;
            right: 20px;
            width: 56px;
            height: 56px;
            background-color: var(--text-primary);
            color: black;
            border-radius: 50%;
            font-size: 30px;
            border: none;
            box-shadow: 0 4px 15px rgba(255,255,255,0.2);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
        }

        /* ëª¨ë‹¬ (íŒì—…) */
        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: #2C2C2E;
            padding: 24px;
            border-radius: 18px;
            width: 80%;
            max-width: 320px;
        }

        .modal h2 { margin-top: 0; color: white; margin-bottom: 20px; }
        
        .input-group { margin-bottom: 16px; }
        .input-group label { display: block; color: #8E8E93; font-size: 13px; margin-bottom: 6px; }
        .input-group input {
            width: 100%;
            background: #1C1C1E;
            border: 1px solid #38383A;
            padding: 12px;
            border-radius: 10px;
            color: white;
            font-size: 16px;
            box-sizing: border-box;
        }

        .modal-actions {
            display: flex;
            gap: 10px;
            margin-top: 24px;
        }

        .btn {
            flex: 1;
            padding: 12px;
            border-radius: 10px;
            border: none;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
        }
        .btn-cancel { background: #3a3a3c; color: white; }
        .btn-save { background: var(--accent-pink); color: white; }
        
        /* ë°±ì—… ë©”ë‰´ */
        .backup-menu {
            display: none;
            position: absolute;
            top: 60px;
            right: 20px;
            background: #2C2C2E;
            border-radius: 12px;
            padding: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            z-index: 90;
            flex-direction: column;
            gap: 5px;
        }
        .backup-btn {
            background: none;
            border: none;
            color: white;
            text-align: left;
            padding: 10px 15px;
            font-size: 14px;
            border-radius: 8px;
        }
        .backup-btn:active { background: #3a3a3c; }

    </style>
</head>
<body>

    <header>
        <h1>ì• ë‹ˆë¦¬ìŠ¤íŠ¸</h1>
        <div class="header-controls">
            <button class="icon-btn" onclick="toggleBackupMenu()">â˜ï¸</button>
            <button class="icon-btn" onclick="openModal()">â•</button>
        </div>
        
        <div id="backupMenu" class="backup-menu">
            <button class="backup-btn" onclick="exportData()">ğŸ“¤ ë°ì´í„° íŒŒì¼ ì €ì¥ (ë°±ì—…)</button>
            <button class="backup-btn" onclick="importData()">ğŸ“¥ ë°ì´í„° íŒŒì¼ ë¶ˆëŸ¬ì˜¤ê¸°</button>
            <input type="file" id="fileInput" style="display: none;" onchange="handleFileSelect(event)">
        </div>
    </header>

    <div class="search-bar">
        <span>ğŸ”</span>
        <input type="text" id="searchInput" placeholder="ì œëª©ìœ¼ë¡œ ê²€ìƒ‰..." oninput="filterList()">
    </div>
    
    <br>

    <div id="anime-list">
        </div>

    <button class="fab" onclick="openModal()">+</button>

    <div id="modal" class="modal">
        <div class="modal-content">
            <h2>ìƒˆ ì‘í’ˆ ì¶”ê°€</h2>
            
            <div class="input-group">
                <label>ì´ë¯¸ì§€ ì£¼ì†Œ (URL)</label>
                <input type="text" id="input-image" placeholder="ì´ë¯¸ì§€ ì£¼ì†Œë¥¼ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”">
            </div>

            <div class="input-group">
                <label>ì œëª©</label>
                <input type="text" id="input-title" placeholder="ì˜ˆ: ìµœì• ì˜ ì•„ì´">
            </div>

            <div style="display: flex; gap: 10px;">
                <div class="input-group" style="flex:1">
                    <label>ì‹œì¦Œ</label>
                    <input type="number" id="input-season" value="1">
                </div>
                <div class="input-group" style="flex:1">
                    <label>í™”ìˆ˜</label>
                    <input type="number" id="input-episode" value="1">
                </div>
            </div>

            <div class="modal-actions">
                <button class="btn btn-cancel" onclick="closeModal()">ì·¨ì†Œ</button>
                <button class="btn btn-save" onclick="addAnime()">ì¶”ê°€</button>
            </div>
        </div>
    </div>

    <script>
        let animeData = JSON.parse(localStorage.getItem('myAnimeList')) || [];

        function renderList(list = animeData) {
            const container = document.getElementById('anime-list');
            container.innerHTML = '';
            
            list.forEach((item, index) => {
                // ì›ë³¸ ë°°ì—´ì—ì„œì˜ ì‹¤ì œ ì¸ë±ìŠ¤ ì°¾ê¸° (ê²€ìƒ‰ ì‹œ í•„ìš”)
                const realIndex = animeData.indexOf(item);

                const card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = `
                    <img src="${item.image || 'https://via.placeholder.com/70x100?text=No+Img'}" class="poster" onerror="this.src='https://via.placeholder.com/70x100?text=Error'">
                    
                    <div class="info">
                        <div class="header-row">
                            <div class="title">${item.title}</div>
                            <select class="status-select" onchange="updateStatus(${realIndex}, this.value)">
                                <option value="watching" ${item.status === 'watching' ? 'selected' : ''}>ë³´ëŠ” ì¤‘</option>
                                <option value="completed" ${item.status === 'completed' ? 'selected' : ''}>ì™„ë£Œ</option>
                                <option value="paused" ${item.status === 'paused' ? 'selected' : ''}>ì¼ì‹œì •ì§€</option>
                            </select>
                        </div>
                        
                        <div class="meta">${item.season}ê¸° ${item.episode}í™”</div>
                        
                        <button class="next-btn" onclick="nextEpisode(${realIndex})">
                            â–¶ ë‹¤ìŒí™”
                        </button>
                    </div>

                    <button class="delete-btn" onclick="deleteItem(${realIndex})">ğŸ—‘ï¸</button>
                `;
                container.appendChild(card);
            });
        }

        // ê¸°ëŠ¥ í•¨ìˆ˜ë“¤
        function addAnime() {
            const title = document.getElementById('input-title').value;
            const season = document.getElementById('input-season').value;
            const episode = document.getElementById('input-episode').value;
            const image = document.getElementById('input-image').value;

            if (!title) { alert('ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!'); return; }

            animeData.push({ title, season, episode, image, status: 'watching' });
            saveAndRender();
            closeModal();
            
            // ì…ë ¥ì°½ ì´ˆê¸°í™”
            document.getElementById('input-title').value = '';
            document.getElementById('input-image').value = '';
        }

        function nextEpisode(index) {
            animeData[index].episode = parseInt(animeData[index].episode) + 1;
            saveAndRender();
        }

        function updateStatus(index, newStatus) {
            animeData[index].status = newStatus;
            saveAndRender();
        }

        function deleteItem(index) {
            if(confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                animeData.splice(index, 1);
                saveAndRender();
            }
        }

        function filterList() {
            const query = document.getElementById('searchInput').value.toLowerCase();
            const filtered = animeData.filter(item => item.title.toLowerCase().includes(query));
            renderList(filtered);
        }

        function saveAndRender() {
            localStorage.setItem('myAnimeList', JSON.stringify(animeData));
            renderList();
        }

        function openModal() { document.getElementById('modal').style.display = 'flex'; }
        function closeModal() { document.getElementById('modal').style.display = 'none'; }

        // --- ë°±ì—… ì‹œìŠ¤í…œ (iCloud ëŒ€ì‹  ì‚¬ìš©) ---
        function toggleBackupMenu() {
            const menu = document.getElementById('backupMenu');
            menu.style.display = menu.style.display === 'flex' ? 'none' : 'flex';
        }

        function exportData() {
            const dataStr = JSON.stringify(animeData);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = 'anime_backup.json';
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            toggleBackupMenu();
        }

        function importData() {
            document.getElementById('fileInput').click();
        }

        function handleFileSelect(event) {
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const loadedData = JSON.parse(e.target.result);
                    if(confirm(`ë°ì´í„° ${loadedData.length}ê°œë¥¼ ë¶ˆëŸ¬ì˜¤ì‹œê² ìŠµë‹ˆê¹Œ? (ê¸°ì¡´ ë°ì´í„°ëŠ” ì‚­ì œë©ë‹ˆë‹¤)`)) {
                        animeData = loadedData;
                        saveAndRender();
                        alert('ë³µì› ì™„ë£Œ!');
                    }
                } catch(err) {
                    alert('íŒŒì¼ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                }
            };
            reader.readAsText(event.target.files[0]);
            toggleBackupMenu();
        }

        // ì´ˆê¸° ì‹¤í–‰
        renderList();
    </script>
</body>
</html>
